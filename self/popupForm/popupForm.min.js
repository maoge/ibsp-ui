(function(a){var b=function(d,c){this.options=c;this.show=function(e){if(e){this.title="Edit "+d}else{this.title="Add "+d}this.$popup||this.createPopupForm(c);this.putData(e);this.$popupTitle.find("div").text(this.title);this.$popup.show();this.resize()};this.putData=function(f){if(f==null){return}for(var e in f){this.$form.find("input[name='"+e+"']").val(f[e])}};this.hide=function(){this.$popup.hide()};this.resize=function(){this.$popupBody.css({"margin-left":-(this.$popupBody.width()/2)+"px","margin-top":-(this.$popupBody.height()/2)+"px"});var e=this.$popupContent.css("padding-top").split("px")[0];this.$popupBody.height(this.$popupTitle.height()+this.contentHeight+this.$popupFoot.height()+3);this.$popupBody.width(this.contentWidth);this.$popupContent.height(this.$popupBody.height()-this.$popupTitle.height()-this.$popupFoot.height()-e*2)};this.createPopupForm=function(e){var f=this;this.createForm(e),this.$popup=a("<div class='popup'></div>"),this.$popupShelter=a("<div class='popupShelter'></div>"),this.$popupBody=a("<div class='popupBody'></div>"),this.$popupTitle=a("<div class='popupBodyTitle'><div>这是一个Title！</div></div>"),this.$popupClose=a("<span class='popupBodyClose'>x</span>"),this.$popupContent=a("<div class = 'popupBodyContent'></div>"),this.$popupFoot=a("<div class = 'popupBodyFoot'></div>"),this.$cancelBtn=a("<button type = 'button' class = 'popupBodyFootBtn' >取消</button>");this.$submitBtn=a("<button type = 'button' class = 'popupBodyFootBtn' >提交修改</button>");this.$popupContent.append(this.$form);this.$popupFoot.append(this.$submitBtn,this.$cancelBtn);this.$popupBody.append(this.$popupTitle,this.$popupClose,this.$popupContent,this.$popupFoot);this.$popup.append(this.$popupShelter,this.$popupBody);this.$popup.appendTo(a("body"));this.contentHeight=this.$popupContent.height();this.contentWidth=this.$popupContent.width();a(window).resize(function(){f.resize()});this.$cancelBtn.click(function(){f.hide()});this.$popupClose.click(function(){f.hide()});this.$submitBtn.click(function(){f.$popupBody.css("z-index",998);var h=f.$form.find("input[disabled=true]").removeAttr("disabled");var g=f.$form.serialize();h.attr("disabled",true);a.ajax({type:"post",url:f.options.url,data:f.$form.serialize(),success:function(i){f.$popupBody.css("z-index",1000);h.removeAttr("disabled");f.$form[0].reset();h.attr("disabled",true);f.options.successCallback(i);f.hide()},error:function(i){f.$popupBody.css("z-index",1000);f.options.errorCallBack(i)}})});this.resize()};this.createForm=function(r){var j=this,g=r.data;this.$form=a("<form class='popupFrom' action='"+r.url+"' method='post'></form>");for(var h in g){var q=g[h];for(var e in q){var o=q[e],p=o.description,l=o.required,f=o.minLength,n=o.type,k=o.pattern,m=a("<fieldset class='popupFormFiedSet'><div class='popupFromGroup'><label class='popupFormLabel'>"+p+"</label><div class = 'popupFormDivInput'><input class = 'popupFormInput' name='"+e+"' /></div></div></fieldset>").appendTo(j.$form)}}a("<div style='height:15px'></div>").appendTo(j.$form)}};a.extend({popupForm:function(g,d,h,f,l){var e,j=[],m={url:d,successCallback:f,errorCallBack:l},k={};i(g,h.properties);c(e);m.data=j;console.log(j);function i(p,o){if(e){return}if(o[p]){e=o[p];return}for(var n in o){var q=o[n]["properties"];q&&i(p,q)}}function c(p){var q=p.type;if(q==="array"){c(p.items)}else{if(q==="object"){var o=p.properties;for(var n in o){var r=new Object();r[n]=o[n];j.push(r)}}}}k=new b(g,m);return k}})})(jQuery);