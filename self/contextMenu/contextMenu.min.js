(function(a){var b=function(d){this.DEFAULT={title:null,items:[]};this.options=a.extend({},this.DEFAULT,d);this.menu=c(this.options);this.html=a("html");this.show=function(i){var f=this,h=i.pageX+5,g=i.pageY;if(g+this.menu.height()>=a(window).height()){g-=this.menu.height()}if(h+this.menu.width()>=a(window).width()){h-=this.menu.width()}this.menu.show();this.menu.css({zIndex:1000000,left:h,top:g});this.html.bind("click",function(){f.hide();f.html.unbind("click");return false});return false};this.hide=function(f){this.menu.hide()};function c(e){var f=a('<ul class="contextMenu"><div class="contextMenu"></div></ul>').appendTo(document.body);e.title&&a('<li class="header"></li>').text(e.title).appendTo(f);e.items.forEach(function(h){if(h&&h==="separator"){a('<li class="divider"></li>').appendTo(f)}else{var g='<li><a href="#">'+(h.icon?'<img src = "'+h.icon+'" />':"")+"<span>"+h.label+"</span></a></li>";var i=a(g).appendTo(f);if(h.callback){i.find("a").click(function(){h.callback(h.label)})}}});return f}};a.fn.contextMenu=function(c){var d=new b(c);this.unbind("contextmenu",function(){}).bind("contextmenu",function(f){d.show(f);return false})};a.fn.contextMenu.Constructor=b;a.extend({contextMenu:function(d){var e=new b(d);var c={};c.show=function(f){e.show(f);e.menu.find("a").each(function(h,g){a(this).unbind("click").bind("click",function(){d.items[h]["callback"](f,d.items[h])})})};return c}})})(jQuery);